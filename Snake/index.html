<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Snake</title>
    <script src="app.js"></script>
    <script src="scripts/Vector.js"></script>
    <script src="scripts/Snake.js"></script>
    <script src="scripts/Star.js"></script>
    <script src="scripts/Render.js"></script>
    <script>
        // Track the mouse's position in the canvas.
        var mouseX = null;
        var mouseY = null;
        function setMouseCoordinates(event)
        {
            mouseX = event.pageX;
            mouseY = event.pageY;
        }
    </script>
</head>
<body>
    <div style="margin: auto">    
        <canvas height="400" width="800" style="background-color: #3987c9;" onmousemove="setMouseCoordinates(event)"></canvas>
    </div>
    <script>
        // Setup.
        var context = document.querySelector("canvas").getContext("2d");
        
        var snake = new Snake();
        snake.addSegment(300, 300);
        snake.addSegment(280, 300);
        snake.addSegment(260, 300);
        snake.addSegment(240, 300);
        snake.addSegment(220, 300);
        snake.addSegment(200, 300);
        snake.addSegment(180, 300);
        snake.addSegment(160, 300);

        var star = null;

        var renderer = new Renderer(context, snake);
        


        // Game loop.
        setInterval(() =>
        {
            // Delete the previous frame.
            context.clearRect(0, 0, 800, 400);

            // Game logic.
            snake.move(mouseX, mouseY);

            if (star === null)
            {
                var x = Math.floor(Math.random() * 800);
                var y = Math.floor(Math.random() * 300);
                star = new Star(x, y);
            }
            else
            {
                star.dim();
                if (star.lifespan === 0)
                    star = null;
            }

            if (star !== null)
            {
                var head = this.snake.segments[0];
                var distance = (new Vector(head.x, head.y)).getDistanceFrom(new Vector(star.x, star.y));
                if(distance < head.radius)
                {
                    star = null;
                    var last = this.snake.segments[this.snake.segments.length - 1];
                    snake.addSegment(last.pointBehind.x, last.pointBehind.y);
                }
            }

            // Render.
            renderer.renderBackground();

            renderer.renderSegments();

            renderer.renderForeground();

            renderer.renderStar();
        }, 16);
    </script>
</body>
</html>
